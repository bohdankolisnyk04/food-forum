{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">

    <div class="card shadow-sm mb-4">
        {% if recipe.image %}
            <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="card-img-top" style="object-fit: cover; max-height: 400px;">
        {% else %}
            <img src="{% static 'images/default_recipe.jpg' %}" alt="Default Image" class="card-img-top" style="object-fit: cover; max-height: 400px;">
        {% endif %}

        <div class="card-body">
            <h2 class="card-title">{{ recipe.title }}</h2>
            <p class="text-muted mb-2">
                Posted on {{ recipe.created_at|date:"F j, Y" }} by
                <a href="{% url 'forum:user-profile' recipe.author.username %}">
                    {{ recipe.author.nickname }}
                </a>
            </p>

            <h5>Description</h5>
            <p>{{ recipe.description|default:"No description available." }}</p>

            <h5>Ingredients</h5>
            {% if recipe.ingredients.exists %}
                <ul>
                    {% for ing in recipe.ingredients.all %}
                        <li>{{ ing.amount }} {{ ing.unit }} {{ ing.product.name }}{% if ing.note %} ({{ ing.note }}){% endif %}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No ingredients added for this recipe.</p>
            {% endif %}

            <h5>Instructions</h5>
            <p>{{ recipe.recipe_text|linebreaks }}</p>

            <h5>Nutrition (per serving)</h5>
            <ul>
                {% for key, value in recipe.nutrition_per_serving.items %}
                    <li>{{ key|capfirst }}: {{ value }}</li>
                {% endfor %}
            </ul>

            <div class="d-flex align-items-center mt-3">
                <!-- Like button -->
                <form action="{% url 'forum:recipe-react' recipe.pk %}" method="post" class="me-2">
                    {% csrf_token %}
                    <input type="hidden" name="value" value="1">
                    <button type="submit" class="btn btn-outline-success">
                        ğŸ‘ Like ({{ recipe.likes_count }})
                    </button>
                </form>

                <!-- Dislike button -->
                <form action="{% url 'forum:recipe-react' recipe.pk %}" method="post" class="me-2">
                    {% csrf_token %}
                    <input type="hidden" name="value" value="-1">
                    <button type="submit" class="btn btn-outline-danger">
                        ğŸ‘ Dislike ({{ recipe.dislikes_count }})
                    </button>
                </form>

                <!-- Save / Saved button -->
                {% if request.user.is_authenticated %}
                    <form action="{% url 'forum:toggle-saved' recipe.pk %}" method="post">
                        {% csrf_token %}
                        {% if is_saved %}
                            <button type="submit" class="btn btn-warning">
                                ğŸ’› Saved
                            </button>
                        {% else %}
                            <button type="submit" class="btn btn-outline-secondary">
                                â¤ï¸ Save
                            </button>
                        {% endif %}
                    </form>
                {% endif %}
            </div>

            <p class="mt-3"><strong>Total Rating:</strong> {{ recipe.rating }}</p>

            <a href="{% url 'forum:forum-home' %}" class="btn btn-secondary mt-3">Back to Home</a>
        </div>
    </div>

</div>
{% endblock %}
